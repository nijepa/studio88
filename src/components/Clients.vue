<template>
  <div class="" >
    <transition name="fall" mode="out-in">
      <div v-if="loadingState" class="" key="1">
        <img src="../assets/img/loading1.gif" alt="" class="loading">
        loading ...
      </div>
    
      <div v-else class="client__wrapper" key="2">
        <div class="">
          <button type="submit" @click="newClient()" class="action_btn client__add">
            <svg version="1.1" id="Capa_1" x="0px" y="0px" fill="var(--purple)"
                width="40px" height="40px" viewBox="0 0 498.306 498.306" style="enable-background:new 0 0 498.306 498.306;">
              <g>
                <g>
                  <path d="M68.107,497.729c0.48,0.377,1.071,0.577,1.677,0.577h41.224c0.517,0,1.01-0.138,1.441-0.41l23.024-14.499h235.166
                    c1.418,0,2.587-1.091,2.688-2.509l0.871-13.155c0.096-1.438-0.961-2.698-2.393-2.845l-159.271-17.04l35.746-46.866l52.154,0.851
                    c0.729-0.016,1.69-0.399,2.21-1.103l16.215-22.189l63.477-26.042l-3.822,31.413c-0.031,0.199-0.031,0.397-0.011,0.587
                    l6.929,69.429l-7.569,16c-0.305,0.641-0.336,1.396-0.1,2.069l3.507,9.647c0.384,1.072,1.396,1.774,2.524,1.774h75.43
                    c0.898,0,1.737-0.452,2.235-1.208c0.499-0.756,0.584-1.69,0.247-2.529l-4.378-10.521c-0.419-1.008-1.4-1.657-2.488-1.657h-18.95
                    l-22.998-26.296l10.421-124.294c0.078-0.74-0.163-1.454-0.662-2.007l-7.024-7.895c-0.509-0.572-1.238-0.907-2.005-0.907h-90.547
                    l-10.231-100.624l10.421-41.649c0.073-0.294,0.1-0.591,0.068-0.903l-7.812-83.313l7.444-12.403
                    c0.541-0.887,0.52-1.997-0.063-2.858l-19.732-30.027V2.688c0-1.483-1.202-2.688-2.688-2.688h-12.278
                    c-1.396,0-2.558,1.066-2.678,2.452l-4.373,49.122c-0.036,0.304-0.005,0.601,0.068,0.892l6.915,27.644l-8.627,105.188l-3.218,1.919
                    c-0.623,0.37-1.064,1.005-1.233,1.714l-3.548,16.068l-13.774,121.389l-17.883,0.787c-0.548,0.022-1.052,0.21-1.483,0.532
                    L135.72,404.011c-0.656,0.483-1.053,1.244-1.086,2.058l-0.785,21.812l-8.627-0.551l0.753-15.776
                    c0.036-0.761-0.247-1.495-0.785-2.036c-0.544-0.535-1.302-0.803-2.042-0.776l-31.806,1.773l-30.699,4.39
                    c-0.548,0.083-1.039,0.314-1.452,0.683l-21.926,20.178c-0.555,0.504-0.866,1.229-0.866,1.974v33.324c0,0.812,0.37,1.584,1.01,2.11
                    L68.107,497.729z"/>
                </g>
              </g>
            </svg>
            <p>Nova vježbačica</p> 
          </button>

          <div class="search__bar">
            <svg version="1.1" id="Layer_1" x="0px" y="0px" height="30px" viewBox="0 0 297.888 297.888">
              <g>
                <path class="svg__parts" style="fill:var(--purple);" d="M218.971,187.618c8.659,8.658,8.659,22.695,0,31.354c-8.657,8.658-22.694,8.657-31.352,0
                  l-50.096-50.096c-8.657-8.658-8.659-22.695-0.001-31.353c8.659-8.659,22.696-8.658,31.355,0L218.971,187.618z"/>
                <circle class="svg__parts" style="fill:var(--purple);" cx="100.697" cy="100.697" r="100.697"/>
                <circle class="svg__parts" style="fill:var(--purple-light);" cx="100.697" cy="100.697" r="64.794"/>
                <path class="svg__parts" style="fill:var(--purple);" d="M186.271,233.504c-13.044-13.042-13.044-34.191,0-47.234c13.043-13.044,34.19-13.043,47.234,0
                  l54.6,54.601c13.044,13.043,13.044,34.19,0,47.234c-13.042,13.043-34.19,13.043-47.234,0L186.271,233.504z"/>
              </g>
            </svg>
            <input type="text" name="search" id="search" 
                    v-model="search" class="login_input search_input">
          </div>
        </div>

        <div class="">
          <div class="clients__heading days__list">
            <span>Ime</span>
            <span>E-mail</span>
            <span>Mobilni</span>
            <span>Aktivna</span>
            <span>Aktivnosti</span>
          </div>

          <div v-for="client in filteredList" :key="client._id" class="clients__list">
            <p class="client__item" 
                @click="selectClient(client)">{{ client.last_name }} , {{ client.first_name }}
            </p>
            <p class="client__item" @click="selectClient(client)">{{ client.email }}</p>
            <p class="client__item" @click="selectClient(client)">{{ client.mobile }}</p>
            <p class="client__item" @click="selectClient(client)">
              <input type="checkbox" class="" v-model="client.active">
            </p>

            <button type="submit" @click="clientActivities(client)" class="activities_btn">
              <svg version="1.1" id="Layer_1" x="0px" y="0px" fill="var(--purple)" width="30px" height="30px"
                    viewBox="0 0 1792.774 1649.856" enable-background="new 0 0 1792.774 1649.856" xml:space="preserve">
                <path d="M454.553,31.721c1.809-3.51,5.275-6.244,9.237-6.794c2.745,1.26,4.231,4.027,5.932,6.352  c2.627-0.431,5.254-1.184,7.935-0.947c7.073,5.814,7.493,16.052,12.93,23.007c1.981-1.916,3.521-4.403,5.997-5.738  c1.497-0.129,2.993-0.022,4.5,0.043c4.866,8.602,7.859,18.044,12.058,26.948c2.573,7.267,7.849,13.382,9.054,21.166  c3.945,10.131,6.999,22.931,21.048,48.997c10.57,18.942,11.051,36.155,22.275,57.438C627.07,319.323,699.534,439.901,706.86,504.93  c-2.379,9.205-1.776,18.733-1.712,28.154c0.269,4.123,1.895,7.999,3.025,11.94c8.988,26.636,7.016,39.514,15.159,158.102  c0.641,60.776,2.943,24.21-6.707,96.649c-0.926,7.547-2.713,15.062-2.788,22.674c1.809,2.853,5.114,4.285,7.547,6.557  c4.694,3.531,7.795,9.237,13.662,11.078c24.473,8.939,46.72,31.978,52.184,35.066c36.078,20.281,43.331,22.369,54.51,29.478  c50.625,28.929,39.227,90.71,46.499,101.03c3.822,6.417,5.663,14.438,3.208,21.672c-2.638,4.845,0.98,9.507,1.658,14.33  c1.26,7.816,6.514,14.071,10.659,20.563c16.903,23.591,21.74,43.604,23.761,50.494c1.758,5.561,10.7,17.92,11.811,20.607  c2.433,5.652,4.317,11.627,7.827,16.763c1.604,2.498,2.39,5.415,3.984,7.935c6.266,5.254,8.99,14.05,16.849,17.549  c8.699,3.682,15.331,12.166,16.225,21.64c0.56,4.49,3.068,8.365,4.586,12.564c0.915,2.498,3.865,3.079,5.932,4.36  c2.875-3.51,6.557-6.535,8.075-10.949c1.55-4.199,5.512-6.643,8.129-10.088c5.803-8.096,12.134-15.837,19.024-23.029  c2.132-2.401,3.004-5.588,4.802-8.215c2.089-3.23,5.792-4.963,7.881-8.204c24.668-38.697,102.667-106.134,102.667-106.134  c1.152-2.627,3.133-4.748,5.523-6.309c4.392-2.817,13.842-16.72,19.336-21.597c3.564-2.821,3.295-8.538,7.655-10.573  c5.598-2.847,22.663-28.152,25.215-31.933c8.504-10.807,9.028-7.678,14.718-12.08c4.532-6.729,6.966-14.62,7.256-22.706  c-1.055-2.487-3.025-4.457-4.21-6.869c-0.344-2.778,0.958-5.62,3.155-7.3c3.94-3.262,6.675-7.698,10.54-11.046  c24.858-22.151,6.796-3.293,48.75-33.031c3.93-3.025,8.742-4.403,13.296-6.201c4.899-1.852,7.827-6.503,12.134-9.259  c14.74-11.124,16.585-6.514,44.206-31.254c6.04-7.935,15.536-12.693,20.542-21.511c1.54-3.316,5.609-3.639,8.053-5.932  c10.002-14.997,18.335-31.028,27.572-46.499c15.816-29.618,36.325-56.318,54.585-84.397  c95.567-154.578,56.87-138.825,119.785-267.929c17.815-32.42,18.507-46.906,28.326-60.969c21.489-30.322,7.306-6.945,34.893-50.181  c3.628-7.806,6.244-16.063,9.302-24.095c3.542-6.352,8.635-11.821,11.337-18.647c2.003-5.351,3.456-10.874,5.405-16.246  c2.487-6.546,2.336-13.867,5.706-20.111c1.701-4.027,4.532-7.386,6.847-11.057c0.452-5.146-0.786-10.486,0.797-15.514  c14.677-20.761,27.665,2.543,31.093,5.028c6.43,4.991,6.04,1.341,12.22,11.671c6.094-0.592,11.531,2.476,17.538,2.756  c4.63,4.242,6.815,11.38,5.512,17.527c-0.84,5.405-6.654,7.278-9.711,11.154c5.835-1.55,11.778-4.931,17.958-2.649  c5.071,1.572,5.222,7.935,4.963,12.306c-0.075,5.588-4.231,9.647-6.567,14.362c1.679,1.044,3.585,1.938,4.877,3.531  c2.998,5.013-0.453,18.674-3.962,23.858c-1.227,2.003-2.961,3.671-3.951,5.792c0.28,2.81,1.055,5.555,1.109,8.398  c0.477,8.434-9.11,42.825-17.043,54.143c-0.96,18.947-3.962,41.629-16.408,73.684c1.27,1.658,2.724,3.23,3.693,5.114  c0.711,3.058,0.054,6.384,1.507,9.302c1.699,3.628,10.508,34.62,2.885,57.632c-2.11,6.858-7.213,12.101-10.809,18.152  c-3.779,6.244-10.002,10.293-15.88,14.33c-4.931,3.607-11.488,2.821-16.634,5.943c-18.387,9.601-23.726,0.941-47.802,29.833  c-36.24,55.627-19.142,77.469-81.35,240.443c-35.465,94.276-38.013,109.851-71.499,153.57c-2.121,6.126-2.433,12.833-4.683,18.97  c-2.635,6.99-13.403,27.296-18.776,33.386c8.258,9.076,14.19,19.971,20.262,30.565c2.616,4.21,2.347,9.281,2.175,14.028  c0.409,2.767-1.658,4.791-4.263,5.125c-7.224-1.669-13.544-6.524-21.199-6.374c1.087,5.781-1.023,11.541-0.301,17.355  c4.526,25.855-8.199,44.383-42.613,45.724c-6.094,1.421-11.746-2.734-17.85-1.755c-7.3,0.065-14.879,1.163-21.877-1.475  c-5.824-0.635-11.66-1.841-17.517-1.066c-6.244-2.864-9.507-11.541-17.431-10.357c-1.916,4.726-0.818,9.873-1.69,14.782  c-3.426,21.012,0.222,5.634-23.137,42.537c-2.767,3.499-3.424,8.042-5.178,12.047c-21.281,50.055-6.478,9.474-26.334,59.828  c-37.592,96.855-48.586,106.806-58.396,125.664c-42.808,70.036-20.134,44.555-77.355,162.57c-3.37,6.977-8.914,12.758-11.477,20.144  c-0.797,1.507-0.56,4.241-0.947,4.134c-1.54,3.338-5.039,5.092-6.654,8.365c-1.486,2.756-3.703,4.996-6.051,7.041  c-3.919,3.176-4.726,8.624-8.484,11.94c-2.433,1.475-5.405,2.164-7.353,4.328c-3.316,4.673-9.647,4.726-14.265,7.472  c-22.79,13.898-68.173,23.996-69.173,24.289c-7.116,2.261-14.75,1.141-21.952,2.971c-11.387,2.797-47.057,1.62-58.935,1.163  c-2.907,0.302-5.695,1.647-8.645,1.324c-53.605-10.656-55.499-27.05-63.381-34.721c-6.686-7.44-14.685-13.802-20.079-22.318  c-0.689-0.054-9.388-5.372-11.552-8.764c-2.487-4.447-7.989-5.437-11.154-9.227c-1.475-3.811-2.121-7.849-3.015-11.8  c-7.694-11.615-11.07-7.987-15.159-13.974c-1.27-2.272-1.626-4.877-2.519-7.267c-0.99-3.316-4.231-5.276-5.329-8.527  c-1.184-2.336-1.055-5.222-2.498-7.364c-3.962-1.733-8.785-1.83-11.886-5.2c-3.844-3.036-2.509-8.365-3.65-12.5  c-2.132-2.498-5.275-4.124-6.74-7.16c-1.884-3.693-2.928-8.408-7.03-10.314c-3.876-2.24-9.302-0.172-12.403-3.876  c-1.41-2.864,1.421-6.74-1.701-8.904c-46.826-42.746-51.268-63.541-77-98.522c-2.433-3.101-6.707-3.94-9.097-7.041  c-1.066-2.476-0.377-5.502-2.089-7.687c-5.028-6.804-10.131-13.544-15.03-20.424c-1.862-2.885-6.438-3.23-7.084-6.923  c-0.926-5.986-6.115-9.636-9.227-14.448c-4.097-6.273-8.842-1.619-16.149-23.589c-4.037-4.005-6.804-9.044-10.712-13.124  c-9.668-7.816-10.615-21.672-18.992-30.415c-4.188-3.015-3.176-8.774-5.48-12.887c-2.95-5.609-6.611-10.842-9.098-16.688  c-1.669-3.445-2.196-7.429-4.597-10.497c-1.443-1.927-2.756-3.983-3.413-6.309c-2.498-9.155-18.168-27.232-23.643-39.889  c-9.737-18.65-15.3-41.617-19.756-44.863c-13.589-10.649-35.371-33.498-42.139-50.451c-2.853-6.675-2.788-13.996-3.66-21.059  c-2.451-23.69,3.977,3.892-8.042-36.347c-1.26-0.022-2.509-0.054-3.747-0.086c-3.908,5.211-7.02,10.96-10.906,16.182  c-2.487,3.262-6.126,5.48-8.344,8.957c-0.689,3.284,0.42,6.729-0.603,9.991c-1.184,4.123-1.281,8.43-1.701,12.683  c-1.378,2.918-5.997,1.324-7.343,4.274c-7.311,13.198-9.34,7.113-14.879,12.015c-5.921,4.349-7.418,12.586-14.276,15.966  c-1.044-2.089-2.089-4.156-3.122-6.234c-3.704-0.829-7.31-1.981-10.96-2.982c-1.83,2.121-3.628,4.274-5.674,6.201  c-1.077-2.67,0.721-5.2,0.851-7.838c-5.438-8.038-19.463-16.369-23.643-21.565c-11.357-13.973-23.455-37.261-25.096-42.624  c-2.064-9.038-21.212-53.916-22.426-58.514c-0.657-2.885-2.433-5.286-4.586-7.224c1.292-4.748-3.596-7.332-4.909-11.358  c-2.541-5.545-2.433-11.886-5.125-17.355c-1.572-3.004-0.764-6.309-0.56-9.474c-7.575-15.918,6.094-63.287,6.75-65.05  c4.511-11.132,4.651-23.33,7.332-34.936c11.761-49.708,36.354-69.826,40.093-74.707c1.421-1.669,0.366-3.984,0.754-5.932  c-0.022-4.07,3.962-6.072,6.783-8.204c-1.845-10.567-19.595-61.653-18.13-91.276c0.129-3.865,0.807-8.064-1.227-11.585  c-6.798-13.197-14.596-20.02-31.75-52.302c-18.795-32.492-63.739-119.56-68.323-127.634  c-15.929-29.196-74.107-109.122-79.412-121.96c-2.264-5.377-7.551-20.031-22.168-28.348c-5.911-3.316-10.842-8.139-16.989-11.057  c-21.594-12.619-8.167,1.819-57.599-49.04c-4.748-6.567-8.107-14.717-15.267-19.132c-5.437-3.079-10.54-6.772-15.127-11.014  c10.802-10.335,15.366-6.771,32.385-4.813c-9.151-16.375-21.705-30.91-28.089-48.76c-6.302-20.654-22.532-36.395-19.993-55.468  c3.294-3.434,8.645-3.714,12.457-6.535c3.155,1.54,6.406,3.23,8.473,6.18c9.045,10.881,28.517,57.699,40.912,65.05  c-1.034-5.469-4.317-10.045-7.267-14.621c-27.833-64.559-21.311-32.392-33.3-74.19c3.187-2.993,7.902-3.025,11.294-5.706  c2.196-1.723,4.92,0.258,7.095,1.098c3.973,1.68,5.362,6.212,8.635,8.71c3.919,0.56,7.02-2.175,10.411-3.542  c11.909,1.712,21.877,24.282,30.372,34.721c17.023,21.314,17.807,25.848,24.913,31.922c-0.93-10.525-20.495-28.141-20.187-44.497  c3.531-0.42,7.612-0.054,10.206-2.961c20.669,7.759,45,65.612,55.618,75.299c9.253,8.948,18.326,19.067,29.639,40.352  c11.746,22.055,23.324,58.757,24.052,62.003c0.915,3.973-0.065,8.15,1.001,12.08c4.407,12.108,170.424,229.1,181.304,232.174  c1.97-1.27,3.542-3.058,5.545-4.263c3.079,1.497,6.783,1.68,9.883,0.205c3.187-3.122,7.429-5.695,8.742-10.217  c-2.487,0.56-4.92,1.281-7.386,1.863c12.635-7.772,18.433-4.557,23.89-4.5c3.37-0.7,6.567-2.412,8.193-5.588  c3.908,3.564,8.505-0.398,12.952,0.398c3.682,0.495,7.321-1.184,11.003-0.323c6.966,1.313,14.082,0.506,21.07-0.215  c9.291-0.431,18.582-0.075,27.885-0.226c15.038-0.236,31.884,12.471,37.843,24.493c2.078,3.661,2.788,7.87,4.64,11.628  c3.165,4.651,7.698,8.225,10.615,13.081c16.614,27.674,18.144,29.116,22.297,30.824c0-15.536-24.93-53.154-35.722-90.641  c-10.583-35.905-12.919-73.813-25.484-109.202c-26.04-76.772-32.533-77.104-52.55-110.935c-8.27-12.823-21.499-13.904-27.292-19.099  c-5.254-4.446-10.056-9.453-15.869-13.21c-4.597-3.23-10.142-5.448-13.404-10.239c-24.592-37.764-9.675-9.788-30.102-39.835  c-2.81-4.371-7.224-7.3-10.54-11.24c7.049-12.089,26.651-4.078,36.078,8.365c0.819,1.001,11.361,13.256,15.363,13.748  c0.129-5.706,1.012-11.531-0.366-17.151c-2.281-11.898,1.617-8.338-4.737-31.459c-1.357-4.823-0.366-9.937-1.647-14.761  c-0.609-2.367-6.984-29.296-4.608-44.206c0.678-3.779,4.199-5.943,5.965-9.13C455.026,42.132,452.583,36.814,454.553,31.721   M399.559,736.652c4.313,20.311,8.026,23.502,20.434,40.696c3.434,4.77,9.916,6.643,12.413,12.198  c1.809,5.928,15.107,19.994,18.626,21.597c-0.506-3.73-8.096-31.857-13.91-37.047c-10.484-11.613-26.015-45.65-31.157-43.905  C403.327,731.775,401.529,734.359,399.559,736.652z"/>
                <path stroke="#000000" stroke-width="0.0938" d="M903.969,1037.065C904.529,1037.625,904.529,1037.625,903.969,1037.065z"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </transition>
    <jw-pagination :items="getAllClients" @changePage="onChangePage" 
                    :labels="customLabels" :styles="customStyles">
    </jw-pagination>
  </div>
</template>

<script>
  import moment from 'moment';
  import { mapGetters, mapActions } from 'vuex';

  const customLabels = {
    first: '<<',
    last: '>>',
    previous: '<',
    next: '>'
  };

  const customStyles = {
    ul: {
        //border: '2px solid red'
    },
    li: {
        display: 'inline-block',
        //border: '2px dotted green'
    },
    a: {
        color: 'var(--purple-dark)'
    }
  };

  export default {
    name: 'Clients',

    data() {
      return {
        pageOfItems: [],
        customLabels,
        customStyles,
        search: '',
        appeared: false
      }
    },

    computed: {
      ...mapGetters([ 'getAllClients', 
                      'loadingState' ]),

      filteredList() {
/*         this.getAllClients.filter(post => {
          return post.name.toLowerCase().includes(this.search.toLowerCase())
        })  */
        
        let mu = this.pageOfItems.filter(post => {
          return post.name.toLowerCase().includes(this.search.toLowerCase()) || 
                  post.email.toLowerCase().includes(this.search.toLowerCase()) || 
                  post.mobile.includes(this.search)
        })
        //this.pageOfItems = mu
        return mu
      }
    },

    methods: {
      ...mapActions([ 'fetchClients', 
                      'fetchClient',
                      'clientClear',
                      'formTypeChange',
                      'setLoadingState' ]),

      onChangePage(pageOfItems) {
        // update page of items
        this.pageOfItems = pageOfItems;
      },
      
      async newClient() {
        this.setLoadingState(true);
        this.formTypeChange('client');
        await this.clientClear();
      },

      async selectClient(client) {
        this.setLoadingState(true);
        await this.fetchClient(client);
        this.formTypeChange('client');
        //this.$emit('toggled-form', 3);
      },

      async clientActivities(client) {
        this.setLoadingState(true);
        await this.fetchClient(client);
        this.formTypeChange('clientactivity');
      },

      onAppeared() {
        this.appeared = true;
      }
    },

    filters: {
      formatDate: function(value) {
        if (value) {
          return moment(String(value)).format('dddd, LL')
        }
      }
    },

    async mounted() {
      await this.fetchClients();
      this.setLoadingState(false);
    }
  }
</script>

<style>
  .client__wrapper {
    display: grid;
    justify-content: center;
    justify-items: left;
  }

  .clients__list {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    grid-column-gap: 1em;
    justify-content: center;
    justify-items: center;
    margin-top: 1em;
    /* cursor: pointer; */
    border-radius: 1em;
    transition: ease .5s all;
  }

  div.clients__list:nth-child(even) {border: 2px solid var(--purple-light);}
  div.clients__list:nth-child(odd) {
/*    background: var(--purple-lighter);
    border: 2px solid transparent; */
  }

  .clients__list:hover {
    background: var(--purple-light);
  }
/* 
  div.clients__list:nth-child(odd):hover {
    background: transparent;
    border: 2px solid var(--purple);
  } */

  .client__item {
    /* background: var(--purple-light); */
    cursor: pointer;
    border-radius: 1em;
    padding: 1em;
    margin: 0;
  }

  .client__add {
    margin-bottom: 1em;
    color: var(--purple);
    border-bottom: 2px solid var(--purple);
  }

  .client__add:hover {
    color: var(--purple-dark);
    border-bottom: 2px solid var(--purple-dark);
  }

  .client__add:hover svg g {
    fill: var(--purple-dark);
  }

  .clients__heading {
    grid-template-columns: repeat(5, 1fr) !important;
  }

  .activities_btn {
    margin: 0;
    padding: .5em;
    border: none;
    cursor: pointer;
    border-radius: 1em;
    z-index: 100;
    transition: ease .5s all;
  }

  .activities_btn:hover {
    background: var(--purple);
    transform: scale(1.1);
  }

  .activities_btn svg {
    z-index: 100;
  }

  .activities_btn:hover svg {
    fill: var(--gold-light);
  }

  .search__bar {
    display: flex;
    align-content: center;
    align-items: center;
  }

  .search__bar svg {
    cursor: pointer;
  }

  .search__bar:hover svg g {
      fill: var(--gold) !important;
    }
  .svg__parts:hover {
    fill: var(--gold) !important;
  }

  .search_input {
    margin-bottom: .1em;
    padding: 0.2em .2em .2em;
  }

  .loading {
    height: 250px;
  }
</style>